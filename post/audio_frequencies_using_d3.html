<!DOCTYPE html>
<html>

<head>
    <title>Audio Frequencies Using D3 | Vathsav</title>
    <meta name="author" content="Vathsav Harikrishnan" />
    <meta property="og:image" content="http://www.vathsav.com/img/audio_frequencies_using_d3/banner.png"/>
    <meta property="og:image:secure_url" content="https://www.vathsav.com/img/audio_frequencies_using_d3/banner.png" />
    <link rel="stylesheet" href="../css/blog.css">
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="icon" href="../img/logo.png?v=2">
    <meta name="viewport" content="width=device-width, user-scalable=no,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />
    <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Ruda:900,400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Josefin+Slab:400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Raleway:200' rel='stylesheet' type='text/css'>
    <script src="https://www.gstatic.com/firebasejs/3.7.3/firebase.js"></script>
    <script src="../node_modules/hogan.js/dist/hogan-3.0.2.min.js"></script>
</head>

<body>
    <audio id="audio-file" src="../download/i_wont_lock_it_down.mp3"></audio>

    <div class="container">
        <div class="row">
            <div class="col-md-9 blog-main content">
                <div class="post">
                    <div class="post_title">Audio Frequencies Using D3</div>
                    <div class="post_info">
                        <i>Saturday 9, December '17</i>
                        <div class="post_category"><img src="../svg/blog/label.svg" height="18px">
                            <a href="../categories/data_visualisation">Data Visualisation</a>
                        </div>
                    </div>
                    <div class="light_hr"></div>
                    <div class="post_content">
                        <p>
                            Alright. This is going to be fun. As usual, after finishing my personal quota of two Rick and Morty
                            episodes per day (too much Rick and Morty is injurious) on Netflix, I opened my half finished John Scalzi
                            book with some soft music in the background and got comfy on my couch.
                        </p>
                        <p>
                            A few pages later, I noticed some awesome visualisations on the YouTube music videos and
                            asked myself, "why not try and make my own audio visualisation?", so here I am at 3:12am writing this post.
                            Life is awesome :)
                        </p>

                        <p>Here's a fun song - <i>I Won't Lock It Down</i> by Jonathan Mann. <a id="play-audio" style="cursor: pointer">Play</a> it
                            <b>(tested only on a computer)</b>!</p>

                        <div id="chart"></div>

                        <p>To those of you who haven't heard of D3, it's a JS library that lets you modify stuff on the
                            DOM and play around with SVGs. Let's have a look at the code.</p>

                        <div class="code">
                            <pre class="prettyprint" style="border: none;">
&lt;audio id="audio-file" src="your-audio.mp3"&gt;&lt;/audio&gt;</pre>
                        </div>

                        <p>
                            First, add this line to your HTML file for your browser to load the audio track.
                        </p>

                        <div class="download_button">
                            <a href="https://github.com/vathsav/audio_visualisation_using_d3" target="_blank">View on GitHub</a>
                        </div>

                        <p>Include the D3.js (<a href="https://www.npmjs.com/package/d3v4">v4</a>) library, and the JavaScript file from my
                            GitHub repo, and you should be good to go.</p>

                        <div class="code">
                            <pre class="prettyprint" style="border: none;">
function renderChart() {
    requestAnimationFrame(renderChart);
    analyser.getByteFrequencyData(frequencyData);

    var finalData = [];

    // Pick only one in four frequencies (don't need that many for the circles)
    frequencyData.forEach(function (value, index) {
        if (index % 4 === 0) {
            if (value < 65) frequencyData[index] = value + 65;
            finalData.push(frequencyData[index]);
        }
    });

    drawPaths([finalData]);
}</pre>
                        </div>

                        <p>I'm using the <a href="https://webaudio.github.io/web-audio-api/">Web Audio API</a> to play around with the
                            audio frequencies. What happens here is that the frequencies are analysed and stored in <i>frequencyData</i>,
                            and I am picking only one in every four frequencies because we don't want too many spikes on our little circles.
                            You can mess around with the mod value for different songs.
                        </p>

                        <div class="code">
                            <pre class="prettyprint" style="border: none;">
function drawPaths(audioFrequencies) {
    // Number of frequencies
    var total = audioFrequencies[0].length;

    // Ensure only one instance of the paths
    d3.selectAll(".happy_path").remove();

    audioFrequencies.forEach(function (frequency) {
        var pathOne = [];
        var pathTwo = [];
        var pathThree = [];
        var pathFour = [];
        var pathFive = [];

        // Lazy inefficient code to make 5 closed paths
        svgVisualisation.selectAll(".nodes")
            .data(frequency, function (value, index) {
                pathOne.push([
                    width / 2 * (1 - (parseFloat(Math.max(value, 0)) / 500) * 1.01 * Math.sin(index * 2 * Math.PI / total)),
                    width / 2 * (1 - (parseFloat(Math.max(value, 0)) / 500) * 1.01 * Math.cos(index * 2 * Math.PI / total))
                ]);

                pathTwo.push([
                    width / 2 * (1 - (parseFloat(Math.max(value, 0)) / 500) * 1.25 * Math.sin(index * 2 * Math.PI / total)),
                    width / 2 * (1 - (parseFloat(Math.max(value, 0)) / 500) * 1.25 * Math.cos(index * 2 * Math.PI / total))
                ]);

                pathThree.push([
                    width / 2 * (1 - (parseFloat(Math.max(value, 0)) / 500) * 1.5 * Math.sin(index * 2 * Math.PI / total)),
                    width / 2 * (1 - (parseFloat(Math.max(value, 0)) / 500) * 1.5 * Math.cos(index * 2 * Math.PI / total))
                ]);

                pathFour.push([
                    width / 2 * (1 - (parseFloat(Math.max(value, 0)) / 500) * 1.75 * Math.sin(index * 2 * Math.PI / total)),
                    width / 2 * (1 - (parseFloat(Math.max(value, 0)) / 500) * 1.75 * Math.cos(index * 2 * Math.PI / total))
                ]);

                pathFive.push([
                    (width / 2 * (1 - (parseFloat(Math.max(value, 0)) / 500) * 2 * Math.sin(index * 2 * Math.PI / total))),
                    (width / 2 * (1 - (parseFloat(Math.max(value, 0)) / 500) * 2 * Math.cos(index * 2 * Math.PI / total)))
                ]);
            });

        pathOne.push(pathOne[0]);
        pathTwo.push(pathTwo[0]);
        pathThree.push(pathThree[0]);
        pathFour.push(pathFour[0]);
        pathFive.push(pathFive[0]);

        var lineFunctionCurvy = d3.line()
            .x(function (d) {
                return d[0];
            })
            .y(function (d) {
                return d[1] - 70;
            })
            .curve(d3.curveBasis);

        svgVisualisation.append("path")
            .attr("d", lineFunctionCurvy(pathFive))
            .attr("stroke", "#424242");

        svgVisualisation.append("path")
            .attr("d", lineFunctionCurvy(pathOne))
            .attr("stroke", "#EC407A");

        svgVisualisation.append("path")
            .attr("d", lineFunctionCurvy(pathTwo))
            .attr("stroke", "#D4E157");

        svgVisualisation.append("path")
            .attr("d", lineFunctionCurvy(pathThree))
            .attr("stroke", "#FF7043");

        svgVisualisation.append("path")
            .attr("d", lineFunctionCurvy(pathFour))
            .attr("stroke", "#26C6DA");

        d3.selectAll("path")
            .attr("class", "happy_path")
            .attr("stroke-width", 3)
            .attr("fill", "none");
    });
}                           </pre>
                        </div>

                        <p>
                            Here, we create the paths and use <a href="https://github.com/d3/d3-shape/blob/master/README.md#curves">curveBasis</a>
                            to create the curved lines along the coordinates of each frequency, and we redraw them every time a new frequency is returned from
                            the audio track.
                        </p>

                        <p>Easy peasy lemon sqeezy! Do share and feel free to comment :)</p>
                    </div>
                    <div class="light_hr"></div>
                    <div class="post_share">
                        <div class="title"><span>Share</span></div>
                        <div class="buttons">
                            <div class="g-plus" data-action="share" data-annotation="none" data-height="24"></div>
                            <div class="fb-share-button" data-href="http://www.vathsav.com/post/audio_frequencies_using_d3" data-layout="button"></div>
                        </div>
                    </div>
                    <div class="light_hr"></div>
                    <div class="post_comment">
                        <div id="disqus_thread"></div>
                        <script type="text/javascript">
                            var disqus_config = function() {
                                this.page.url = 'http://vathsav.com/post/audio_frequencies_using_d3';
                                this.page.identifier = 'audio_frequencies_using_d3';
                                this.page.title = 'Audio Frequencies Using D3';
                            };

                            (function() { // DON'T EDIT BELOW THIS LINE
                                var d = document,
                                    s = d.createElement('script');
                                s.src = '//vathsav.disqus.com/embed.js';
                                s.setAttribute('data-timestamp', +new Date());
                                (d.head || d.body).appendChild(s);
                            })();
                        </script>
                        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="sidebar" id="sidebar"></div>
            </div>
        </div>
    </div>

    <div id="commons"></div>

    <div class="footer" id="footer"></div>

    <!-- Load Templates -->
    <script src="../templates/sidebar.js"></script>
    <script src="../templates/commons.js"></script>
    <script src="../templates/footer.js"></script>

    <script type="text/javascript">
        document.getElementById('sidebar').innerHTML = templates['sidebar'].render();
        document.getElementById('commons').innerHTML = templates['commons'].render();
        document.getElementById('footer').innerHTML = templates['footer'].render();
    </script>

    <!-- JS Imports -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="http://www.vathsav.com/js/analytics.js"></script>
    <script src="http://www.vathsav.com/js/classie.js"></script>
    <script src="http://www.vathsav.com/js/config.js"></script>
    <script src="http://www.vathsav.com/js/effects.js"></script>
    <script src="http://www.vathsav.com/js/subscribe.js"></script>
    <script src="../libs/d3v4.min.js"></script>
    <script src="../js/post_exclusive/visualiser.js"></script>

    <!-- External -->
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <div id="fb-root"></div>
    <script>
        (function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s);
            js.id = id;
            js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.3";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
    </script>

    <!-- Code for comment count -->
    <script type="text/javascript">
        var disqus_shortname = 'vathsav';
        (function() {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
</body>

</html>
